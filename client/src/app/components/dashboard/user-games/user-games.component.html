<div class="user-games-modal">
    <ng-template #userGamesContent let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h3 class="modal-title">Create your game</h3>
            <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')">
                <i class="fas fa-times"></i>
                <span aria-hidden="true"></span>
            </button>
        </div>
        <div class="modal-body game-form">
            <form [formGroup]="gameCreationForm" (ngSubmit)="createGame()">
                <div class="form-group">
                    <label class="input-label">
                        <span class="input-label-content">Game Title</span>
                        <p class="help-text">Enter the title of the game.</p>
                        <input placeholder="My Awesome Risk Game" type="text" class="input-field" formControlName="title">
                    </label>
                </div>
                <div class="form-group">
                    <label class="input-label">
                        <span class="input-label-content">Game Type</span>
                        <p class="help-text">Choose which type of game you want to create. Private games are restricted to you and the people you invite below. Public games are open to anyone but will be closed once the game timer is up, if the maximum number of players is reached, or if you manually start the game.</p>
                    </label>
                    <div class="radio-button-container">
                        <div class="button-container">
                            <input id="private_game_type" type="radio" class="radio-field" formControlName="gameType" value="private" [checked]="true">
                            <label for="private_game_type">Private</label>
                            <div class="check"></div>
                        </div>
                        <div class="button-container">
                            <input id="public_game_type" type="radio" class="radio-field" value="public" formControlName="gameType">
                            <label for="public_game_type">Public</label>
                            <div class="check"></div>
                        </div>
                    </div>
                </div>
                <div [hidden]="this.gameCreationForm.get('gameType').value === 'public'" class="form-group" formArrayName="usernames">
                    <div class="usernames-block">
                        <label class="input-label">
                            <span class="input-label-content">Invite Players</span>
                            <button [disabled]="usernames.controls.length === 5" type="button" class="add-username" (click)="addUsername()">
                                <i class="fas fa-plus"></i>
                            </button>
                            <p class="help-text">Enter the usernames of the players you want to invite. The users need to already have registered and created a username. You must have at least one other user playing with you and you can only add up to a MAXIMUM OF 5 OTHER PLAYERS.</p>
                        </label>
                        <div class="dynamic-username-container" *ngFor="let username of usernames.controls; let i=index" [formGroupName]="i">
                            <input placeholder="Enter player {{i + 1}}'s username" type="text" class="input-field" formControlName="uname">
                            <span *ngIf="usernames.at(i).get('uname').status === 'PENDING'" class="fas fa-spinner fa-spin status-icon"></span>
                            <span *ngIf="usernames.at(i).get('uname').errors === null && usernames.at(i).get('uname').status === 'VALID'" class="fas fa-check status-icon"></span>
                            <button [hidden]="i === 0" type="button" class="remove-username" (click)="removeUsername(i)">
                                <i class="fas fa-minus"></i>
                            </button>

                            <div *ngIf="usernames.at(i).get('uname').touched && usernames.at(i).get('uname').errors !== null" class="username-error">
                                <p *ngIf="usernames.at(i).get('uname').errors.usernameDoesNotExist">
                                    Username does not exist! Make sure you are spelling the username correctly or the user you are entering has registered on the site.
                                </p>
                                <p *ngIf="usernames.at(i).get('uname').errors.minlength">
                                    Please enter a username that is 3 characters or more.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div [hidden]="this.gameCreationForm.get('gameType').value === 'private'" class="form-group">
                    <div class="select-container">
                        <label class="input-label">
                            <span class="input-label-content">Maximum Number of Players</span>
                            <p class="help-text">Choose the number of players you want in the game. Once this number is reached, the game will automatically start. You can also choose to manually start the game if at least one other user has joined your game.</p>
                            <select name="numberOfPlayers" class="select-box" formControlName="numberOfPlayers">
                                <option *ngFor="let number of [2,3,4,5,6]" [value]="number">
                                    {{number}}
                                </option>
                            </select>
                        </label>
                        <i class="fas fa-caret-down"></i>
                    </div>
                </div>
                <div class="form-group buttons-container">
                    <button type="button" (click)="d('Cancel clicked')" class="btn btn-vermillion">Cancel</button>
                    <button type="submit" class="btn btn-aqua">Create Game</button>
                </div>
            </form>
        </div>
    </ng-template>
    <button class="btn btn-yellow create-game" (click)="open(userGamesContent)"><i class="fas fa-plus"></i> Create Game</button>
</div>
<div class="games-info-list">
    <risk-accordion>
        <ng-template #pendingGames>
            <h3>Pending Games <span class="counter-badge">{{ pendingGamesList.length }}</span></h3>
        </ng-template>
        <risk-accordion-panel [panelHeading]="pendingGames">
            <div class="game-block" *ngFor="let game of pendingGamesList; let i = index">
                <risk-slide-panel #rsp>
                    <ng-template #leftPane>
                        <div class="title-block clearfix">
                            <h4 (click)="rsp.setPanelState('right')">{{game.title}} <i class="fas fa-angle-right"></i></h4>
                            <div class="buttons-container">
                                <button [disabled]="game.players.length < 2" type="button" class="btn btn-yellow">Start Game</button>
                                <button type="button" class="btn btn-vermillion">Cancel Game</button>
                            </div>
                        </div>
                        <div class="quick-info-block">
                            <p>Waiting on:</p>
                            <ul>
                                <li *ngFor="let p of game.pendingPlayers">
                                    {{p.player.username}}
                                    <button type="button" class="btn btn-vermillion">Nudge {{p.player.username}}</button>
                                </li>
                            </ul>
                        </div>
                    </ng-template>
                    <ng-template #rightPane>
                        <a [routerLink]="" (click)="rsp.setPanelState('left')">Back to pending games list</a>
                        <div class="game-info">
                            <p><span>Created at: {{game.createdAt}}</span></p>
                            <p>Players invited:</p>
                            <ul>
                                <li *ngFor="let p of game.players">
                                    {{p.player.username}}
                                </li>
                            </ul>
                        </div>
                    </ng-template>
                </risk-slide-panel>
            </div>
        </risk-accordion-panel>

        <ng-template #inProgressGames>
            <h3>In Progress Games</h3>
        </ng-template>
        <risk-accordion-panel [panelHeading]="inProgressGames">
            <p>In progress games!</p>
        </risk-accordion-panel>

        <ng-template #completedGames>
            <h3>Completed Games</h3>
        </ng-template>
        <risk-accordion-panel [panelHeading]="completedGames">
            <p>Completed games!</p>
        </risk-accordion-panel>
    </risk-accordion>
</div>
<!--
1. Pending games
    - Things to show:
        - manually allow creator to start game if one other player has joined
        - title
        - date created
        - game code
        - players invited and their statuses
        - indication of private or public (icon)
2. In Progress games
    - Things to show:
        - title
        - current leader
        - territories held by each player
        - any players that are knocked out
        - current person's turn
        - allow creator to "nudge" person to take turn if more than 24 hours
3. Completed games
    - Things to show:
        - winner
        - replay option
        - end date
        - time it took to complete
        - stats for each user during the game (e.g. held a certain continent longest or lost the most battles etc.)
-->
